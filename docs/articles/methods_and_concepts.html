<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Methods and concepts • breathtestcore</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">breathtestcore</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data_formats.html">Data formats in package breathtestcore</a>
    </li>
    <li>
      <a href="../articles/methods_and_concepts.html">Methods and concepts</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dmenne/breathtestcore">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Methods and concepts</h1>
                        <h4 class="author">Dieter Menne, Menne Biomed Consulting Tuebingen, <a href="mailto:dieter.menne@menne-biomed.de">dieter.menne@menne-biomed.de</a>
</h4>
            
          </div>

    
    
<div class="contents">
<div id="a-heretical-view-on-13c-breath-test-for-gastric-emptying" class="section level1">
<h1 class="hasAnchor">
<a href="#a-heretical-view-on-13c-breath-test-for-gastric-emptying" class="anchor"></a>A heretical view on <sup>13</sup>C breath test for gastric emptying</h1>
<p><sup>13</sup>C breath test data are evaluated in clinical practice and in research as an indirect measure of gastric emptying. The normative literature on the underlying concepts is given in the documentation of <code><a href="../reference/exp_beta.html">exp_beta()</a></code>, <code><a href="../reference/t50_maes_ghoos.html">t50_maes_ghoos()</a></code> and <code><a href="../reference/t50_bluck_coward.html">t50_bluck_coward()</a></code>.</p>
<p>Here, I present a subjective viewpoint on the pharmakokinetics of breath test time series. After a look at the Maes/Ghoos method (<span class="citation">Ghoos et al. (<a href="#ref-Ghoos1993">1993</a>)</span>, <span class="citation">Maes et al. (<a href="#ref-Maes1998b">1998</a>)</span>) as it is currently used, alternatives are discussed in the <a href="#secondlook">next section</a>.</p>
<div id="current-concepts" class="section level2">
<h2 class="hasAnchor">
<a href="#current-concepts" class="anchor"></a>Current concepts</h2>
<p>Within the standard framework implemented in this package, data are fitted to an exponential beta function</p>
<p><span class="math display">\[{PDR} = m*{dose}*k*\beta(1-e^{-k*minute})^{(\beta - 1)}*e^{-k*minute}\]</span></p>
<p>Written in R code</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp_beta =<span class="st"> </span><span class="cf">function</span>(minute,dose,m,k,beta) {
     m<span class="op">*</span>dose<span class="op">*</span>k<span class="op">*</span>beta<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">exp</span>(<span class="op">-</span>k<span class="op">*</span>minute))<span class="op">^</span>(beta<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="kw">exp</span>(<span class="op">-</span>k<span class="op">*</span>minute)
}</code></pre></div>
<p>The figure below shows examples of emptying curves. The so-called lag time of the Maes/Ghoos method is at the time of the maximum. Calling this “lag” is a highly confusing definition; technically, lag is the time until a first noticable rise occurs in the curve, best illustrated by the blue curves with <code>beta = 8</code>, which has an estimated lag of about 15 minutes. If one looks more closely, even this definition is misleading, because the curves with higher beta are not zero, but start to rise from the origin like a polynomial curve with a power of <code>beta - 1</code>. A real lag would be best illustrated by a curve shifted to the right by <code>t_lag</code> and pdr values of 0 for <code>t &lt; t_lag</code>, indicating a real physical transport of the meal from the stomach to the small intestine.</p>
<p>In practice, when <sup>13</sup>C curves are fitted, <code>beta</code> is typically in the range of 1.5 and 2.5; values of <code>beta</code> near 1 often lead to instabilities and are protected by priors in the <code><a href="http://www.rdocumentation.org/packages/breathteststan/topics/stan_fit">breathteststan::stan_fit()</a></code> implemented in the separate package <code>breathteststan</code>.</p>
<div class="figure">
<img src="methods_and_concepts_files/figure-html/expb-1.png" alt="Examples of exponential beta functions used to fit breath test curves. _Bottom-up arrow_: Maes/Ghoos lag time. _Top-down arrow_: Maes/Ghoos half emptying time." width="576"><p class="caption">
Examples of exponential beta functions used to fit breath test curves. <em>Bottom-up arrow</em>: Maes/Ghoos lag time. <em>Top-down arrow</em>: Maes/Ghoos half emptying time.
</p>
</div>
<p>The half-emptying as defined by <span class="citation">Maes et al. (<a href="#ref-Maes1998b">1998</a>)</span> is the time where the area under curve (AUC) is half the AUC extrapolated to infinity. In pharmakokinetics terms, it is the time where half of the bioavailable <sup>13</sup>C has been metabolized. This time is determined both by gastric emptying and by the pharmacokinetics of <sup>13</sup>C bound in octanoate/acetate.</p>
<div class="figure">
<img src="methods_and_concepts_files/figure-html/t50-1.png" alt="The half-emptying time in the definition of Maes/Ghoos is the time where the area under curve (AUC) is half of the AUC under the curve extrapolated to infinity." width="384"><p class="caption">
The half-emptying time in the definition of Maes/Ghoos is the time where the area under curve (AUC) is half of the AUC under the curve extrapolated to infinity.
</p>
</div>
<p>The AUC <em>extrapolated to infinity</em>, which is the denominator in the definition of <code>t50</code>, is highly critical. Even if we accept that the exponential beta function is a reasonable model for breath test time series, extrapolating individual curves from data only slightly longer than <code>t50</code> results in highly ambiguous area estimates, often fails to converge, and even more often gives wildly romantic estimates of <code>t50</code>.</p>
<p>To illustrate how brittle the <em>AUC to infinity</em> is, look back at a different function that had been used to fit <sup>13</sup>C time series. <span class="citation">Ghoos et al. (<a href="#ref-Ghoos1993">1993</a>)</span> used the following Gamma function to fit the data:</p>
<p><span class="math display">\[pdr = a*t^b*e^{-ct}\]</span> As the figure below shows, this function gives perfectly valid fits of breath test time series. However, the area under curve extrapolated to infinity is infinite, so it cannot be used to compute a half-emptying time from the AUC.</p>
<div class="figure">
<img src="methods_and_concepts_files/figure-html/gamma-1.png" alt="Gamma function from @Ghoos1993 definition as points, and beta exponential as line. Both function look very similar, but the area under the gamma function is infinite and thus cannot be used to compute t50." width="384"><p class="caption">
Gamma function from <span class="citation">Ghoos et al. (<a href="#ref-Ghoos1993">1993</a>)</span> definition as points, and beta exponential as line. Both function look very similar, but the area under the gamma function is infinite and thus cannot be used to compute t50.
</p>
</div>
</div>
<div id="dieters-soapbox" class="section level2">
<h2 class="hasAnchor">
<a href="#dieters-soapbox" class="anchor"></a>Dieter’s soapbox</h2>
<p>I therefore recommend using one of the population method, as implemented in <code><a href="../reference/nlme_fit.html">nlme_fit()</a></code> and <code>stan_fit()</code> for studies; these methods provide “borrowing strength” to keep the flock of lambs safely together and protect outliers from the big bad wolf.</p>
<ul>
<li>If you write or review a paper that uses single curve fits to report study results, rewrite or reject it. Using the function provided in this package is <a href="https://en.wikipedia.org/wiki/Gratis_versus_libre">free as in beer and in speech</a>, and when you use the <a href="https://apps.menne-biomed.de/gastempt/">online version</a>, you do not even have to install R. The <a href="https://dmenne.github.io/breathtestcore/articles/data_formats.html">vignette</a> gives details on how to prepare your data with Excel.</li>
<li>For clinical practice, you have single measurements for which you want an immediate result. You can use the Bayesian method to get stabile estimates; or, if you want to be fancy, prepare a data set of some of your previous cases, add the new patient’s data as a mix-in, and use the Mixed-model or the Bayesian fit.</li>
</ul>
<div class="figure">
<img src="methods.png" alt="The fitting methods available in package `breathtestshiny` and in the [online version](https://apps.menne-biomed.de/breathtestshiny/)." width="134"><p class="caption">
The fitting methods available in package <code>breathtestshiny</code> and in the <a href="https://apps.menne-biomed.de/breathtestshiny/">online version</a>.
</p>
</div>
</div>
<div id="secondlook" class="section level2">
<h2 class="hasAnchor">
<a href="#secondlook" class="anchor"></a>A second look</h2>
<p>The half-emptying time determined with the <sup>13</sup>C breath test method correlates to some extend with gastric emptying in within subject measurements, but it is not more than a surrogate for gastric emptying times measured by MRI (with secretion) or scintigraphy (meal-only). For data set <code>usz_13c_d</code> in this package, MRI emptying data are available and can be compared with <a href="https://dmenne.github.io/breathtestcore/reference/usz_13c_d.html#examples">breath test data</a>. The type of meal strongly biases the estimates because of the the dependency on lipophilic/lipophobic layering; comparing different meal types is not reliable even within-subject, and less so between-subject.</p>
<p>Many attempts have been made to extract more information from the emptying curve, and to correct for the overall too high values; the Bluck-Coward method implemented in this package is one of them, but the <a href="https://dmenne.github.io/breathtestcore/reference/usz_13c_d.html#examples">results</a> are are even more inconsistent with those from MRI than those from the Maes/Ghoos method. I do not know of any publication which has used rigorous statistical tests such as statistical cross-validation and validation with different meal types to show that some method gives “better” results than the default Maes/Ghoos</p>
<blockquote>
<p>In the following, I argue that there is nothing to gain from playing with “better” methods to fit the breath test time series. Additional per-subject information must be aquired to separate acetate pharmacokinetics from gastric empyting, which is physical transport.</p>
</blockquote>
<div id="acetate-pharmacology" class="section level3">
<h3 class="hasAnchor">
<a href="#acetate-pharmacology" class="anchor"></a>Acetate pharmacology</h3>
<p>Assume we do not mix the labelled acetate with the meal, but hide it in an enteric tablet as it is used for PPI. Nothing will happen when the tablet is in the stomach, but it will quickly release <sup>13</sup>C labelled acetate in the duodenum or small intestine, mimicing a one-time dose. As described by standard pharmacokinetics, this will lead to a PDR response following a first-order compartmental model. Forgetting about decorative normalization constants, the response is the difference between two exponential functions:</p>
<p><span class="math display">\[{foc} =  e^{-k_1 * {minute}} - e^{-k_2 * {minute}}\]</span></p>
<p>The normalization constant includes clearance and dose and only scales the curve. The correct normalization constants can be found in standard texts on pharmacokinetics (<span class="citation">Gabrielsson and Weiner (<a href="#ref-Gabrielsson2006">2006</a>)</span>) or in as a base R function <code><a href="http://www.rdocumentation.org/packages/stats/topics/SSfol">stats::SSfol()</a></code> in <span class="citation">Pinheiro and Bates (<a href="#ref-R:PinheiroBates2000">2000</a>)</span>.</p>
<div class="figure">
<img src="methods_and_concepts_files/figure-html/foc-1.png" alt="Left: pharmcological PDR response of separated loads released in the smaller bowel after 0, 30 and 90 minutes. Right: sum response when all three loads are released successively." width="672"><p class="caption">
Left: pharmcological PDR response of separated loads released in the smaller bowel after 0, 30 and 90 minutes. Right: sum response when all three loads are released successively.
</p>
</div>
<p>The left panel in the above plot shows three examples of <sup>13</sup>C fed by an enteric tables, remaining in the stomach for 0, 30 and 90 minutes and then quickly being released in the smaller intestine. Note that we have a real lag caused by physical transport here: before the tablet is in the smaller bowel, there is no response at all. This is different from the polynomial-like pseudo-lag with the beta-exponential function.</p>
<p>The right panel in the above plot shows the summary PDR curve when the three tablets are fed together and by chance are released after 0, 30 and 90 minutes. This mimics the case of a stomach releasing the meal in three chunks of the same size and composition, well known from <a href="https://en.wikipedia.org/wiki/Pharmacokinetics#/media/File:Linear_PK_Example.png">pharmacokinetics</a> for multiple doses of a drug.</p>
<p>The real flow out of the stomach is not pulse-like, but more like that of a continuous infusion. When we assume the stomach empties with a power-exponential function as in the left panel (see <code><a href="http://www.rdocumentation.org/packages/gastempt/topics/gastemptfunc">gastempt::powexp()</a></code>), the flow is a wide peak as shown in the right panel below. The response technically is the convolution of the flow with the pulse response shown as red curve(t_lag = 0) in the above plot.</p>
<div class="figure">
<img src="methods_and_concepts_files/figure-html/powexp-1.png" alt="Meal volume (left) and flow when gastric emptying function is a power exponential function. Slope was computed with  function `gastempt::powexp_slope()` with inverted sign. 400 ml initial value, tempt = 100, beta = 1.8 Half empyting times t50 are marked by arrows." width="768"><p class="caption">
Meal volume (left) and flow when gastric emptying function is a power exponential function. Slope was computed with function <code><a href="http://www.rdocumentation.org/packages/gastempt/topics/gastemptfunc">gastempt::powexp_slope()</a></code> with inverted sign. 400 ml initial value, tempt = 100, beta = 1.8 Half empyting times t50 are marked by arrows.
</p>
</div>
<p>The correct half-emptying time <code>t50</code> in this example was 82 minutes, as determined from the left panel; <code>t50</code> determined by fitting with the Maes/Ghoos version in the right panel was 109 minutes.</p>
<p>The bias from fitting the PDR curve naively is is cause by the convolution of mechanical transport in gastric emptying, and pharmacological drug kinetics. The latter is a nuisance parameter and should be eliminated - or is it a parameter of interest in it’s own?</p>
</div>
</div>
<div id="how-to-correct-for-the-pharmacological-bias" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-correct-for-the-pharmacological-bias" class="anchor"></a>How to correct for the pharmacological bias?</h2>
<blockquote>
<p>I propose a revised procedure to separate pharmacology from transport. Patient receive 30 mg acetate in an enteric table together with water. DOB data are recorded for 60 minutes, and after that the normal procedure of meal with 100 mg acetate/octanoate. The resulting PDR will look as follows:</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">data.frame</span>(<span class="dt">pdr =</span> <span class="kw">c</span>(ff_<span class="dv">0</span>[<span class="dv">0</span><span class="op">:</span><span class="dv">59</span>]<span class="op">*</span><span class="dv">50</span>, <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">20</span>), cv<span class="op">$</span>pdr)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">minute =</span> <span class="dv">0</span><span class="op">:</span>(<span class="kw">n</span>()<span class="op">-</span><span class="dv">1</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(minute <span class="op">%%</span><span class="st"> </span><span class="dv">10</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">pdr =</span> pdr <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">n</span>(), <span class="dv">0</span>, <span class="dv">1</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> minute, <span class="dt">y =</span> pdr)) <span class="op">+</span>
<span class="st">           </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">col =</span> <span class="st">"gray"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">360</span>, <span class="dt">by =</span> <span class="dv">60</span>))</code></pre></div>
<div class="figure">
<img src="methods_and_concepts_files/figure-html/sim2stage-1.png" alt="Simulated response of a two-stage breath test procedure. The peak within the first hour is from acetate directly release in the small bowel, the second wider peak is the result of the convolution of transport emptying and pharmacokinetics." width="384"><p class="caption">
Simulated response of a two-stage breath test procedure. The peak within the first hour is from acetate directly release in the small bowel, the second wider peak is the result of the convolution of transport emptying and pharmacokinetics.
</p>
</div>
<p>The first narrow peak up to 1 hour is the pharmacological response; by fitting it, the kinetic time constants that broaden the wide peak can be determined, and can be used to remove the bias of the transport component visible in the main peak by mathematical deconvolution.</p>
<p>Can anyone supply a data set for a pilot?</p>
</div>
</div>
<div id="why-do-we-need-population-fits" class="section level1">
<h1 class="hasAnchor">
<a href="#why-do-we-need-population-fits" class="anchor"></a>Why do we need population fits?</h1>
<p>Currently outsourced to <a href="http://menne-biomed.de/blog/breath-test-stan">A comparison of results with nls, nlme</a> and Bayesian <a href="http://www.mc-stan.org">Stan</a>.</p>
<p>A less technical discussion will be added here.</p>
<div id="why-no-wagner-nelson" class="section level2">
<h2 class="hasAnchor">
<a href="#why-no-wagner-nelson" class="anchor"></a>Why no Wagner-Nelson?</h2>
<p>A popular alternative when curve fitting does not work is the Wagner-Nelson method which uses non-parametric approaches for the initial slope. However, it makes a assumption about the terminal slope being the same for all subject (k=0.01/min, 0.65/h). Since this assumption strongly affects the estimate of the half-emptying time, there is little justification to use the Wagner-Nelson method.</p>
</div>
<div id="citations" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#citations" class="anchor"></a>Citations</h2>
<div id="refs" class="references">
<div id="ref-Gabrielsson2006">
<p>Gabrielsson, Johan, and Dan Weiner. 2006. <em>Pharmacokinetic &amp; Pharmacodynamic Data Analysis : Concepts and Applications</em>. 4. ed., rev. and expanded. PK/Pd Data Analysis: Concepts and Applications. Stockholm: Swedish Pharmaceutical Press.</p>
</div>
<div id="ref-Ghoos1993">
<p>Ghoos, Y. F., B. D. Maes, B. J. Geypens, G. Mys, M. I. Hiele, P. J. Rutgeerts, and G. Vantrappen. 1993. “Measurement of Gastric Emptying Rate of Solids by Means of a Carbon-Labeled Octanoic Acid Breath Test.” <em>Gastroenterology</em> 104 (6). Department of Medicine, University Hospital Gasthuisberg, Belgium.: 1640–7.</p>
</div>
<div id="ref-Maes1998b">
<p>Maes, B. D., B. J. Geypens, Y. F. Ghoos, M. I. Hiele, and P. J. Rutgeerts. 1998. “13C-Octanoic Acid Breath Test for Gastric Emptying Rate of Solids.” <em>Gastroenterology</em> 114 (4): 856–59.</p>
</div>
<div id="ref-R:PinheiroBates2000">
<p>Pinheiro, Jose C., and Douglas M. Bates. 2000. <em>Mixed-Effects Models in S and S-Plus</em>. Springer.</p>
</div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#a-heretical-view-on-13c-breath-test-for-gastric-emptying">A heretical view on <sup>13</sup>C breath test for gastric emptying</a><ul class="nav nav-pills nav-stacked">
<li><a href="#current-concepts">Current concepts</a></li>
      <li><a href="#dieters-soapbox">Dieter’s soapbox</a></li>
      <li><a href="#secondlook">A second look</a></li>
      <li><a href="#how-to-correct-for-the-pharmacological-bias">How to correct for the pharmacological bias?</a></li>
      </ul>
</li>
      <li>
<a href="#why-do-we-need-population-fits">Why do we need population fits?</a><ul class="nav nav-pills nav-stacked">
<li><a href="#why-no-wagner-nelson">Why no Wagner-Nelson?</a></li>
      <li><a href="#citations">Citations</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Dieter Menne, Menne Biomed Consulting Tübingen</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
